<!DOCTYPE HTML>
<html>

<head>
	<title>GamePad</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<style>
		html {
			font-family: Helvetica;
			display: inline-block;
			text-align: center;
		}

		body {
			margin: 0;
		}

		img {
			width: auto;
			max-width: 100%;
			height: auto;
		}
	</style>
	<script src="joy.min.js"></script>
</head>

<body>
	<img src="" id="stream" />

	<div id="joyDiv" style="width:200px;height:200px;margin:auto;"></div>
	<!--
	<div>
		Posizione X:<input id="joyPosizioneX" type="text" /><br />
		Posizione Y:<input id="joyPosizioneY" type="text" /><br />
		Direzione:<input id="joyDirezione" type="text" /><br />
		X :<input id="joyX" type="text" /><br />
		Y :<input id="joyY" type="text" />
	</div>
	-->
	<script type="text/javascript">
		var joyParam = { "title": "joystick" };
		var Joy = new JoyStick('joyDiv', joyParam);

		var joyIinputPosX = document.getElementById("joyPosizioneX");
		var joyInputPosY = document.getElementById("joyPosizioneY");
		var joyDirezione = document.getElementById("joyDirezione");
		var joyX = document.getElementById("joyX");
		var joyY = document.getElementById("joyY");

		//setInterval(function () { joyIinputPosX.value = Joy.GetPosX(); }, 300);
		//setInterval(function () { joyInputPosY.value = Joy.GetPosY(); }, 300);
		//setInterval(function () { joyDirezione.value = Joy.GetDir(); }, 300);
		//setInterval(function () { joyX.value = Joy.GetX(); }, 300);
		//etInterval(function () { joyY.value = Joy.GetY(); }, 300);
		//setInterval(function () { send(joyX.value + "," + joyY.value) }, 300);
		setInterval(function () { send(Joy.GetX() + "," + Joy.GetY()) }, 300);
	</script>
	<script>
		var gateway = `ws://${window.location.hostname}/ws`;
		var websocket;
		function initWebSocket() {
			console.log('Trying to open a WebSocket connection...');
			websocket = new WebSocket(gateway);
			websocket.onopen = onOpen;
			websocket.onclose = onClose;
			websocket.onmessage = onMessage;
		}
		function onOpen(event) {
			console.log('Connection opened');
		}
		function onClose(event) {
			console.log('Connection closed');
			setTimeout(initWebSocket, 2000);
		}
		function onMessage(event) {
			if (event && event.data) {
				console.log(event.data);
			}
		}
		function send(msg) {
			if (websocket != null) {
				websocket.send("" + msg);
			}
		}

		window.addEventListener('load', onLoad);

		function onLoad(event) {
			initWebSocket();
			document.getElementById("stream").src = window.location.href.slice(0, -1)  + "/stream";
		}
	</script>
</body>

</html>